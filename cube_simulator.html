<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="./static/css/bootstrap.min.css">
  <link rel="icon" href="/MaplestoryWiki/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="/MaplestoryWiki/favicon.ico" type="image/x-icon">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>魔方模拟器(施工中)</title>
  <style>
    /* 预留侧栏宽度后在剩余区域居中（通用） */
    .remain-center {
      padding-left: 240px;
    }

    .remain-center .inner {
      margin: 0 auto;
      width: min(1100px, calc(100vw - 240px));
      min-width: 320px;
      padding: 0 12px;
    }
  </style>
</head>

<body>
  <!-- JavaScript 动态加载左侧目录 -->
  <div id="sidebar-container"></div>
  <div class="container my-4">
    <div class="remain-center">
      <div class="inner">
        <h1 class="mb-4">魔方模拟器</h1>

        <div class="row g-4">
          <div class="col-12">
            <div class="card shadow-sm mb-4">
              <div class="card-header fw-bold" role="button" data-bs-toggle="collapse" data-bs-target="#cubeCollapse"
                aria-expanded="true" aria-controls="cubeCollapse">魔方概率查询</div>
              <div id="cubeCollapse" class="collapse show">
                <div class="card-body">
                  <div class="row g-3 align-items-end">
                    <div class="col-12 col-md-3">
                      <label class="form-label">装备类型</label>
                      <select id="equipType" class="form-select">
                        <option value="武器">武器</option>
                        <option value="辅助武器">辅助武器</option>
                        <option value="徽章">徽章</option>
                        <option value="坠饰">坠饰</option>
                        <option value="戒指">戒指</option>
                        <option value="脸部装饰">脸部装饰</option>
                        <option value="眼部装饰">眼部装饰</option>
                        <option value="耳环">耳环</option>
                        <option value="帽子">帽子</option>
                        <option value="上衣">上衣</option>
                        <option value="套服">套服</option>
                        <option value="下衣">下衣</option>
                        <option value="手套">手套</option>
                        <option value="鞋子">鞋子</option>
                        <option value="披风">披风</option>
                        <option value="腰带">腰带</option>
                        <option value="肩膀">肩膀</option>
                        <option value="心脏">心脏</option>
                        <option value="胸章">胸章</option>
                      </select>
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="form-label">装备等级</label>
                      <select id="equipLevel" class="form-select">
                        <option value="140">140</option>
                        <option value="150" selected>150</option>
                        <option value="160">160</option>
                        <option value="200">200</option>
                        <option value="250">250</option>
                      </select>
                    </div>
                    <div class="col-12 col-md-3">
                      <label class="form-label">当前潜能</label>
                      <select id="currentTier" class="form-select">
                        <option value="Rare">特殊 (Rare)</option>
                        <option value="Epic">稀有 (Epic)</option>
                        <option value="Unique" selected>罕见 (Unique)</option>
                        <option value="Legendary">传说 (Legendary)</option>
                      </select>
                    </div>
                    <div class="col-12 col-md-3">
                      <label class="form-label">魔方类型</label>
                      <select id="cubeType" class="form-select">
                        <option>恢复方块</option>
                        <option>闪耀镜射方块</option>
                        <option>闪炫方块</option>
                        <option>新对等方块</option>
                        <option>结合方块</option>
                      </select>
                    </div>
                    <div class="col-12 d-flex gap-2 flex-wrap">
                      <button id="showBtn" class="btn btn-primary">准备打水漂</button>
                    </div>
                  </div>
                  <!-- 当前潜能选择框 -->
                  <div class="row g-3 mt-2" id="currentLinesGroup">
                    <div class="col-12 small text-muted">请选择当前三条潜能（默认均为“垃圾”）：</div>
                    <div class="col-12 col-md-4">
                      <label class="form-label">当前第1条</label>
                      <select id="currentLine1" class="form-select"></select>
                    </div>
                    <div class="col-12 col-md-4">
                      <label class="form-label">当前第2条</label>
                      <select id="currentLine2" class="form-select"></select>
                    </div>
                    <div class="col-12 col-md-4">
                      <label class="form-label">当前第3条</label>
                      <select id="currentLine3" class="form-select"></select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card shadow-sm mb-4">
          <div class="card-header fw-bold" role="button" data-bs-toggle="collapse" data-bs-target="#resultCollapse"
            aria-expanded="true" aria-controls="resultCollapse">跳框概率表</div>
          <div id="resultCollapse" class="collapse show">
            <div class="card-body">
              <div id="probSummary" class="mb-2 small text-muted"></div>
              <div class="table-responsive">
                <div id="probTableContainer" class="mt-2"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="card shadow-sm mb-4">
          <div class="card-header fw-bold" role="button" data-bs-toggle="collapse" data-bs-target="#tierResultCollapse"
            aria-expanded="true" aria-controls="tierResultCollapse">结果概率表</div>
          <div id="tierResultCollapse" class="collapse show">
            <div class="card-body">
              <div class="table-responsive">
                <div id="resultTierTableContainer" class="mt-2"></div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>

    // --- 固定顺序与显示名 ---
    const TIERS = ['Rare', 'Epic', 'Unique', 'Legendary'];
    const TIER_LABEL = {
      'Rare': '特殊 (Rare)',
      'Epic': '稀有 (Epic)',
      'Unique': '罕见 (Unique)',
      'Legendary': '传说 (Legendary)'
    };
    const uniqueData = {
      "恢复方块": {
        "帽子": {
          "垃圾": 43.4,
          "STR%": 9.43,
          "DEX%": 9.43,
          "INT%": 9.43,
          "LUK%": 9.43,
          "最大HP%": 11.32,
          "全属性%": 7.55
        },
        "上衣": {
          "垃圾": 52.379999999999995,
          "STR%": 7.94,
          "DEX%": 7.94,
          "INT%": 7.94,
          "LUK%": 7.94,
          "最大HP%": 9.52,
          "全属性%": 6.35
        },
        "套服": {
          "垃圾": 52.379999999999995,
          "STR%": 7.94,
          "DEX%": 7.94,
          "INT%": 7.94,
          "LUK%": 7.94,
          "最大HP%": 9.52,
          "全属性%": 6.35
        },
        "下衣": {
          "垃圾": 45.45,
          "STR%": 9.09,
          "DEX%": 9.09,
          "INT%": 9.09,
          "LUK%": 9.09,
          "最大HP%": 10.91,
          "全属性%": 7.27
        },
        "手套": {
          "STR": 1.75,
          "DEX": 1.75,
          "INT": 1.75,
          "LUK": 1.75,
          "垃圾": 40.36,
          "STR%": 8.77,
          "DEX%": 8.77,
          "INT%": 8.77,
          "LUK%": 8.77,
          "最大HP%": 10.53,
          "全属性%": 7.02
        },
        "鞋子": {
          "垃圾": 43.4,
          "STR%": 9.43,
          "DEX%": 9.43,
          "INT%": 9.43,
          "LUK%": 9.43,
          "最大HP%": 11.32,
          "全属性%": 7.55
        },
        "披风": {
          "STR%": 10.2,
          "DEX%": 10.2,
          "INT%": 10.2,
          "LUK%": 10.2,
          "最大HP%": 12.24,
          "垃圾": 38.76,
          "全属性%": 8.16
        },
        "腰带": {
          "STR%": 10.2,
          "DEX%": 10.2,
          "INT%": 10.2,
          "LUK%": 10.2,
          "最大HP%": 12.24,
          "垃圾": 38.76,
          "全属性%": 8.16
        },
        "肩膀": {
          "STR%": 10.2,
          "DEX%": 10.2,
          "INT%": 10.2,
          "LUK%": 10.2,
          "最大HP%": 12.24,
          "垃圾": 38.76,
          "全属性%": 8.16
        },
        "心脏": {
          "STR%": 10.2,
          "DEX%": 10.2,
          "INT%": 10.2,
          "LUK%": 10.2,
          "最大HP%": 12.24,
          "垃圾": 38.76,
          "全属性%": 8.16
        },
        "胸章": {
          "STR%": 10.2,
          "DEX%": 10.2,
          "INT%": 10.2,
          "LUK%": 10.2,
          "最大HP%": 12.24,
          "垃圾": 38.76,
          "全属性%": 8.16
        },
        "坠饰": {
          "STR%": 12.2,
          "DEX%": 12.2,
          "INT%": 12.2,
          "LUK%": 12.2,
          "最大HP%": 14.63,
          "垃圾": 26.83,
          "全属性%": 9.76
        },
        "戒指": {
          "STR%": 12.2,
          "DEX%": 12.2,
          "INT%": 12.2,
          "LUK%": 12.2,
          "最大HP%": 14.63,
          "垃圾": 26.83,
          "全属性%": 9.76
        },
        "脸部装饰": {
          "STR%": 12.2,
          "DEX%": 12.2,
          "INT%": 12.2,
          "LUK%": 12.2,
          "最大HP%": 14.63,
          "垃圾": 26.83,
          "全属性%": 9.76
        },
        "眼部装饰": {
          "STR%": 12.2,
          "DEX%": 12.2,
          "INT%": 12.2,
          "LUK%": 12.2,
          "最大HP%": 14.63,
          "垃圾": 26.83,
          "全属性%": 9.76
        },
        "耳环": {
          "STR%": 12.2,
          "DEX%": 12.2,
          "INT%": 12.2,
          "LUK%": 12.2,
          "最大HP%": 14.63,
          "垃圾": 26.83,
          "全属性%": 9.76
        },
        "武器": {
          "物理攻击力%": 6.52,
          "魔法攻击力%": 6.52,
          "总伤害%": 6.52,
          "无视怪物防御力+30%": 8.7,
          "攻击BOSS怪物时伤害增加+30%": 6.52,
          "爆击几率%": 10.87,
          "STR%": 10.87,
          "DEX%": 10.87,
          "INT%": 10.87,
          "LUK%": 10.87,
          "全属性%": 10.87
        },
        "辅助武器": {
          "物理攻击力%": 6.52,
          "魔法攻击力%": 6.52,
          "总伤害%": 6.52,
          "无视怪物防御力+30%": 8.7,
          "攻击BOSS怪物时伤害增加+30%": 6.52,
          "爆击几率%": 10.87,
          "STR%": 10.87,
          "DEX%": 10.87,
          "INT%": 10.87,
          "LUK%": 10.87,
          "全属性%": 10.87
        },
        "徽章": {
          "物理攻击力%": 6.98,
          "魔法攻击力%": 6.98,
          "总伤害%": 6.98,
          "无视怪物防御力+30%": 9.3,
          "爆击几率%": 11.63,
          "STR%": 11.63,
          "DEX%": 11.63,
          "INT%": 11.63,
          "LUK%": 11.63,
          "全属性%": 11.63
        }
      },
      "闪耀镜射方块": {
        "帽子": {
          "垃圾": 65.72,
          "STR%": 5.71,
          "DEX%": 5.71,
          "INT%": 5.71,
          "LUK%": 5.71,
          "最大HP%": 5.71,
          "全属性%": 5.71
        },
        "上衣": {
          "垃圾": 73.33000000000001,
          "STR%": 4.44,
          "DEX%": 4.44,
          "INT%": 4.44,
          "LUK%": 4.44,
          "最大HP%": 4.44,
          "全属性%": 4.44
        },
        "套服": {
          "垃圾": 73.33000000000001,
          "STR%": 4.44,
          "DEX%": 4.44,
          "INT%": 4.44,
          "LUK%": 4.44,
          "最大HP%": 4.44,
          "全属性%": 4.44
        },
        "下衣": {
          "垃圾": 67.56,
          "STR%": 5.41,
          "DEX%": 5.41,
          "INT%": 5.41,
          "LUK%": 5.41,
          "最大HP%": 5.41,
          "全属性%": 5.41
        },
        "手套": {
          "STR": 2.56,
          "DEX": 2.56,
          "INT": 2.56,
          "LUK": 2.56,
          "垃圾": 58.98,
          "STR%": 5.13,
          "DEX%": 5.13,
          "INT%": 5.13,
          "LUK%": 5.13,
          "最大HP%": 5.13,
          "全属性%": 5.13
        },
        "鞋子": {
          "垃圾": 65.72,
          "STR%": 5.71,
          "DEX%": 5.71,
          "INT%": 5.71,
          "LUK%": 5.71,
          "最大HP%": 5.71,
          "全属性%": 5.71
        },
        "披风": {
          "STR%": 6.45,
          "DEX%": 6.45,
          "INT%": 6.45,
          "LUK%": 6.45,
          "最大HP%": 6.45,
          "垃圾": 61.28,
          "全属性%": 6.45
        },
        "腰带": {
          "STR%": 6.45,
          "DEX%": 6.45,
          "INT%": 6.45,
          "LUK%": 6.45,
          "最大HP%": 6.45,
          "垃圾": 61.28,
          "全属性%": 6.45
        },
        "肩膀": {
          "STR%": 6.45,
          "DEX%": 6.45,
          "INT%": 6.45,
          "LUK%": 6.45,
          "最大HP%": 6.45,
          "垃圾": 61.28,
          "全属性%": 6.45
        },
        "心脏": {
          "STR%": 6.45,
          "DEX%": 6.45,
          "INT%": 6.45,
          "LUK%": 6.45,
          "最大HP%": 6.45,
          "垃圾": 61.28,
          "全属性%": 6.45
        },
        "胸章": {
          "STR%": 6.45,
          "DEX%": 6.45,
          "INT%": 6.45,
          "LUK%": 6.45,
          "最大HP%": 6.45,
          "垃圾": 61.28,
          "全属性%": 6.45
        },
        "坠饰": {
          "STR%": 8.7,
          "DEX%": 8.7,
          "INT%": 8.7,
          "LUK%": 8.7,
          "最大HP%": 8.7,
          "垃圾": 47.83,
          "全属性%": 8.7
        },
        "戒指": {
          "STR%": 8.7,
          "DEX%": 8.7,
          "INT%": 8.7,
          "LUK%": 8.7,
          "最大HP%": 8.7,
          "垃圾": 47.83,
          "全属性%": 8.7
        },
        "脸部装饰": {
          "STR%": 8.7,
          "DEX%": 8.7,
          "INT%": 8.7,
          "LUK%": 8.7,
          "最大HP%": 8.7,
          "垃圾": 47.83,
          "全属性%": 8.7
        },
        "眼部装饰": {
          "STR%": 8.7,
          "DEX%": 8.7,
          "INT%": 8.7,
          "LUK%": 8.7,
          "最大HP%": 8.7,
          "垃圾": 47.83,
          "全属性%": 8.7
        },
        "耳环": {
          "STR%": 8.7,
          "DEX%": 8.7,
          "INT%": 8.7,
          "LUK%": 8.7,
          "最大HP%": 8.7,
          "垃圾": 47.83,
          "全属性%": 8.7
        },
        "武器": {
          "物理攻击力%": 2.7,
          "魔法攻击力%": 2.7,
          "总伤害%": 2.7,
          "无视怪物防御力+30%": 5.41,
          "攻击BOSS怪物时伤害增加+30%": 5.41,
          "爆击几率%": 13.51,
          "STR%": 13.51,
          "DEX%": 13.51,
          "INT%": 13.51,
          "LUK%": 13.51,
          "全属性%": 13.51
        },
        "辅助武器": {
          "物理攻击力%": 2.7,
          "魔法攻击力%": 2.7,
          "总伤害%": 2.7,
          "无视怪物防御力+30%": 5.41,
          "攻击BOSS怪物时伤害增加+30%": 5.41,
          "爆击几率%": 13.51,
          "STR%": 13.51,
          "DEX%": 13.51,
          "INT%": 13.51,
          "LUK%": 13.51,
          "全属性%": 13.51
        },
        "徽章": {
          "物理攻击力%": 2.86,
          "魔法攻击力%": 2.86,
          "总伤害%": 2.86,
          "无视怪物防御力+30%": 5.71,
          "爆击几率%": 14.29,
          "STR%": 14.29,
          "DEX%": 14.29,
          "INT%": 14.29,
          "LUK%": 14.29,
          "全属性%": 14.29
        }
      },
      "闪炫方块": {
        "帽子": {
          "垃圾": 43.4,
          "STR%": 9.43,
          "DEX%": 9.43,
          "INT%": 9.43,
          "LUK%": 9.43,
          "最大HP%": 11.32,
          "全属性%": 7.55
        },
        "上衣": {
          "垃圾": 52.379999999999995,
          "STR%": 7.94,
          "DEX%": 7.94,
          "INT%": 7.94,
          "LUK%": 7.94,
          "最大HP%": 9.52,
          "全属性%": 6.35
        },
        "套服": {
          "垃圾": 52.379999999999995,
          "STR%": 7.94,
          "DEX%": 7.94,
          "INT%": 7.94,
          "LUK%": 7.94,
          "最大HP%": 9.52,
          "全属性%": 6.35
        },
        "下衣": {
          "垃圾": 45.45,
          "STR%": 9.09,
          "DEX%": 9.09,
          "INT%": 9.09,
          "LUK%": 9.09,
          "最大HP%": 10.91,
          "全属性%": 7.27
        },
        "手套": {
          "STR": 1.75,
          "DEX": 1.75,
          "INT": 1.75,
          "LUK": 1.75,
          "垃圾": 40.36,
          "STR%": 8.77,
          "DEX%": 8.77,
          "INT%": 8.77,
          "LUK%": 8.77,
          "最大HP%": 10.53,
          "全属性%": 7.02
        },
        "鞋子": {
          "垃圾": 43.4,
          "STR%": 9.43,
          "DEX%": 9.43,
          "INT%": 9.43,
          "LUK%": 9.43,
          "最大HP%": 11.32,
          "全属性%": 7.55
        },
        "披风": {
          "STR%": 10.2,
          "DEX%": 10.2,
          "INT%": 10.2,
          "LUK%": 10.2,
          "最大HP%": 12.24,
          "垃圾": 38.76,
          "全属性%": 8.16
        },
        "腰带": {
          "STR%": 10.2,
          "DEX%": 10.2,
          "INT%": 10.2,
          "LUK%": 10.2,
          "最大HP%": 12.24,
          "垃圾": 38.76,
          "全属性%": 8.16
        },
        "肩膀": {
          "STR%": 10.2,
          "DEX%": 10.2,
          "INT%": 10.2,
          "LUK%": 10.2,
          "最大HP%": 12.24,
          "垃圾": 38.76,
          "全属性%": 8.16
        },
        "心脏": {
          "STR%": 10.2,
          "DEX%": 10.2,
          "INT%": 10.2,
          "LUK%": 10.2,
          "最大HP%": 12.24,
          "垃圾": 38.76,
          "全属性%": 8.16
        },
        "胸章": {
          "STR%": 10.2,
          "DEX%": 10.2,
          "INT%": 10.2,
          "LUK%": 10.2,
          "最大HP%": 12.24,
          "垃圾": 38.76,
          "全属性%": 8.16
        },
        "坠饰": {
          "STR%": 12.2,
          "DEX%": 12.2,
          "INT%": 12.2,
          "LUK%": 12.2,
          "最大HP%": 14.63,
          "垃圾": 26.83,
          "全属性%": 9.76
        },
        "戒指": {
          "STR%": 12.2,
          "DEX%": 12.2,
          "INT%": 12.2,
          "LUK%": 12.2,
          "最大HP%": 14.63,
          "垃圾": 26.83,
          "全属性%": 9.76
        },
        "脸部装饰": {
          "STR%": 12.2,
          "DEX%": 12.2,
          "INT%": 12.2,
          "LUK%": 12.2,
          "最大HP%": 14.63,
          "垃圾": 26.83,
          "全属性%": 9.76
        },
        "眼部装饰": {
          "STR%": 12.2,
          "DEX%": 12.2,
          "INT%": 12.2,
          "LUK%": 12.2,
          "最大HP%": 14.63,
          "垃圾": 26.83,
          "全属性%": 9.76
        },
        "耳环": {
          "STR%": 12.2,
          "DEX%": 12.2,
          "INT%": 12.2,
          "LUK%": 12.2,
          "最大HP%": 14.63,
          "垃圾": 26.83,
          "全属性%": 9.76
        },
        "武器": {
          "物理攻击力%": 6.52,
          "魔法攻击力%": 6.52,
          "总伤害%": 6.52,
          "无视怪物防御力+30%": 8.7,
          "攻击BOSS怪物时伤害增加+30%": 6.52,
          "爆击几率%": 10.87,
          "STR%": 10.87,
          "DEX%": 10.87,
          "INT%": 10.87,
          "LUK%": 10.87,
          "全属性%": 10.87
        },
        "辅助武器": {
          "物理攻击力%": 6.52,
          "魔法攻击力%": 6.52,
          "总伤害%": 6.52,
          "无视怪物防御力+30%": 8.7,
          "攻击BOSS怪物时伤害增加+30%": 6.52,
          "爆击几率%": 10.87,
          "STR%": 10.87,
          "DEX%": 10.87,
          "INT%": 10.87,
          "LUK%": 10.87,
          "全属性%": 10.87
        },
        "徽章": {
          "物理攻击力%": 6.98,
          "魔法攻击力%": 6.98,
          "总伤害%": 6.98,
          "无视怪物防御力+30%": 9.3,
          "爆击几率%": 11.63,
          "STR%": 11.63,
          "DEX%": 11.63,
          "INT%": 11.63,
          "LUK%": 11.63,
          "全属性%": 11.63
        }
      },
      "新对等方块": {
        "帽子": {
          "垃圾": 43.4,
          "STR%": 9.43,
          "DEX%": 9.43,
          "INT%": 9.43,
          "LUK%": 9.43,
          "最大HP%": 11.32,
          "全属性%": 7.55
        },
        "上衣": {
          "垃圾": 52.379999999999995,
          "STR%": 7.94,
          "DEX%": 7.94,
          "INT%": 7.94,
          "LUK%": 7.94,
          "最大HP%": 9.52,
          "全属性%": 6.35
        },
        "套服": {
          "垃圾": 52.379999999999995,
          "STR%": 7.94,
          "DEX%": 7.94,
          "INT%": 7.94,
          "LUK%": 7.94,
          "最大HP%": 9.52,
          "全属性%": 6.35
        },
        "下衣": {
          "垃圾": 45.45,
          "STR%": 9.09,
          "DEX%": 9.09,
          "INT%": 9.09,
          "LUK%": 9.09,
          "最大HP%": 10.91,
          "全属性%": 7.27
        },
        "手套": {
          "STR": 1.75,
          "DEX": 1.75,
          "INT": 1.75,
          "LUK": 1.75,
          "垃圾": 40.36,
          "STR%": 8.77,
          "DEX%": 8.77,
          "INT%": 8.77,
          "LUK%": 8.77,
          "最大HP%": 10.53,
          "全属性%": 7.02
        },
        "鞋子": {
          "垃圾": 43.4,
          "STR%": 9.43,
          "DEX%": 9.43,
          "INT%": 9.43,
          "LUK%": 9.43,
          "最大HP%": 11.32,
          "全属性%": 7.55
        },
        "披风": {
          "STR%": 10.2,
          "DEX%": 10.2,
          "INT%": 10.2,
          "LUK%": 10.2,
          "最大HP%": 12.24,
          "垃圾": 38.76,
          "全属性%": 8.16
        },
        "腰带": {
          "STR%": 10.2,
          "DEX%": 10.2,
          "INT%": 10.2,
          "LUK%": 10.2,
          "最大HP%": 12.24,
          "垃圾": 38.76,
          "全属性%": 8.16
        },
        "肩膀": {
          "STR%": 10.2,
          "DEX%": 10.2,
          "INT%": 10.2,
          "LUK%": 10.2,
          "最大HP%": 12.24,
          "垃圾": 38.76,
          "全属性%": 8.16
        },
        "心脏": {
          "STR%": 10.2,
          "DEX%": 10.2,
          "INT%": 10.2,
          "LUK%": 10.2,
          "最大HP%": 12.24,
          "垃圾": 38.76,
          "全属性%": 8.16
        },
        "胸章": {
          "STR%": 10.2,
          "DEX%": 10.2,
          "INT%": 10.2,
          "LUK%": 10.2,
          "最大HP%": 12.24,
          "垃圾": 38.76,
          "全属性%": 8.16
        },
        "坠饰": {
          "STR%": 12.2,
          "DEX%": 12.2,
          "INT%": 12.2,
          "LUK%": 12.2,
          "最大HP%": 14.63,
          "垃圾": 26.83,
          "全属性%": 9.76
        },
        "戒指": {
          "STR%": 12.2,
          "DEX%": 12.2,
          "INT%": 12.2,
          "LUK%": 12.2,
          "最大HP%": 14.63,
          "垃圾": 26.83,
          "全属性%": 9.76
        },
        "脸部装饰": {
          "STR%": 12.2,
          "DEX%": 12.2,
          "INT%": 12.2,
          "LUK%": 12.2,
          "最大HP%": 14.63,
          "垃圾": 26.83,
          "全属性%": 9.76
        },
        "眼部装饰": {
          "STR%": 12.2,
          "DEX%": 12.2,
          "INT%": 12.2,
          "LUK%": 12.2,
          "最大HP%": 14.63,
          "垃圾": 26.83,
          "全属性%": 9.76
        },
        "耳环": {
          "STR%": 12.2,
          "DEX%": 12.2,
          "INT%": 12.2,
          "LUK%": 12.2,
          "最大HP%": 14.63,
          "垃圾": 26.83,
          "全属性%": 9.76
        },
        "武器": {
          "物理攻击力%": 6.52,
          "魔法攻击力%": 6.52,
          "总伤害%": 6.52,
          "无视怪物防御力+30%": 8.7,
          "攻击BOSS怪物时伤害增加+30%": 6.52,
          "爆击几率%": 10.87,
          "STR%": 10.87,
          "DEX%": 10.87,
          "INT%": 10.87,
          "LUK%": 10.87,
          "全属性%": 10.87
        },
        "辅助武器": {
          "物理攻击力%": 6.52,
          "魔法攻击力%": 6.52,
          "总伤害%": 6.52,
          "无视怪物防御力+30%": 8.7,
          "攻击BOSS怪物时伤害增加+30%": 6.52,
          "爆击几率%": 10.87,
          "STR%": 10.87,
          "DEX%": 10.87,
          "INT%": 10.87,
          "LUK%": 10.87,
          "全属性%": 10.87
        },
        "徽章": {
          "物理攻击力%": 6.98,
          "魔法攻击力%": 6.98,
          "总伤害%": 6.98,
          "无视怪物防御力+30%": 9.3,
          "爆击几率%": 11.63,
          "STR%": 11.63,
          "DEX%": 11.63,
          "INT%": 11.63,
          "LUK%": 11.63,
          "全属性%": 11.63
        }
      },
      "结合方块": {
        "帽子": {
          "垃圾": 65.55,
          "STR%": 6.56,
          "DEX%": 6.56,
          "INT%": 6.56,
          "LUK%": 6.56,
          "最大HP%": 6.56,
          "全属性%": 1.64
        },
        "上衣": {
          "垃圾": 76.67,
          "STR%": 4.44,
          "DEX%": 4.44,
          "INT%": 4.44,
          "LUK%": 4.44,
          "最大HP%": 4.44,
          "全属性%": 1.11
        },
        "套服": {
          "垃圾": 76.67,
          "STR%": 4.44,
          "DEX%": 4.44,
          "INT%": 4.44,
          "LUK%": 4.44,
          "最大HP%": 4.44,
          "全属性%": 1.11
        },
        "下衣": {
          "垃圾": 62.5,
          "STR%": 7.14,
          "DEX%": 7.14,
          "INT%": 7.14,
          "LUK%": 7.14,
          "最大HP%": 7.14,
          "全属性%": 1.79
        },
        "手套": {
          "STR": 5.75,
          "DEX": 5.75,
          "INT": 5.75,
          "LUK": 5.75,
          "垃圾": 47.14,
          "STR%": 5.75,
          "DEX%": 5.75,
          "INT%": 5.75,
          "LUK%": 5.75,
          "最大HP%": 5.75,
          "全属性%": 1.15
        },
        "鞋子": {
          "垃圾": 62.87,
          "STR%": 7.14,
          "DEX%": 7.14,
          "INT%": 7.14,
          "LUK%": 7.14,
          "最大HP%": 7.14,
          "全属性%": 1.43
        },
        "披风": {
          "STR%": 8.77,
          "DEX%": 8.77,
          "INT%": 8.77,
          "LUK%": 8.77,
          "最大HP%": 8.77,
          "垃圾": 54.4,
          "全属性%": 1.75
        },
        "腰带": {
          "STR%": 8.77,
          "DEX%": 8.77,
          "INT%": 8.77,
          "LUK%": 8.77,
          "最大HP%": 8.77,
          "垃圾": 54.4,
          "全属性%": 1.75
        },
        "肩膀": {
          "STR%": 8.77,
          "DEX%": 8.77,
          "INT%": 8.77,
          "LUK%": 8.77,
          "最大HP%": 8.77,
          "垃圾": 54.4,
          "全属性%": 1.75
        },
        "心脏": {
          "STR%": 8.77,
          "DEX%": 8.77,
          "INT%": 8.77,
          "LUK%": 8.77,
          "最大HP%": 8.77,
          "垃圾": 54.4,
          "全属性%": 1.75
        },
        "胸章": {
          "STR%": 8.77,
          "DEX%": 8.77,
          "INT%": 8.77,
          "LUK%": 8.77,
          "最大HP%": 8.77,
          "垃圾": 54.4,
          "全属性%": 1.75
        },
        "坠饰": {
          "STR%": 13.51,
          "DEX%": 13.51,
          "INT%": 13.51,
          "LUK%": 13.51,
          "最大HP%": 13.51,
          "垃圾": 29.73,
          "全属性%": 2.7
        },
        "戒指": {
          "STR%": 13.51,
          "DEX%": 13.51,
          "INT%": 13.51,
          "LUK%": 13.51,
          "最大HP%": 13.51,
          "垃圾": 29.73,
          "全属性%": 2.7
        },
        "脸部装饰": {
          "STR%": 13.51,
          "DEX%": 13.51,
          "INT%": 13.51,
          "LUK%": 13.51,
          "最大HP%": 13.51,
          "垃圾": 29.73,
          "全属性%": 2.7
        },
        "眼部装饰": {
          "STR%": 13.51,
          "DEX%": 13.51,
          "INT%": 13.51,
          "LUK%": 13.51,
          "最大HP%": 13.51,
          "垃圾": 29.73,
          "全属性%": 2.7
        },
        "耳环": {
          "STR%": 13.51,
          "DEX%": 13.51,
          "INT%": 13.51,
          "LUK%": 13.51,
          "最大HP%": 13.51,
          "垃圾": 29.73,
          "全属性%": 2.7
        },
        "武器": {
          "物理攻击力%": 8.22,
          "魔法攻击力%": 8.22,
          "总伤害%": 16.44,
          "无视怪物防御力+30%": 20.55,
          "攻击BOSS怪物时伤害增加+30%": 5.48,
          "爆击几率%": 27.4,
          "STR%": 2.74,
          "DEX%": 2.74,
          "INT%": 2.74,
          "LUK%": 2.74,
          "全属性%": 2.74
        },
        "辅助武器": {
          "物理攻击力%": 8.22,
          "魔法攻击力%": 8.22,
          "总伤害%": 16.44,
          "无视怪物防御力+30%": 20.55,
          "攻击BOSS怪物时伤害增加+30%": 5.48,
          "爆击几率%": 27.4,
          "STR%": 2.74,
          "DEX%": 2.74,
          "INT%": 2.74,
          "LUK%": 2.74,
          "全属性%": 2.74
        },
        "徽章": {
          "物理攻击力%": 8.7,
          "魔法攻击力%": 8.7,
          "总伤害%": 17.39,
          "无视怪物防御力+30%": 21.74,
          "爆击几率%": 28.99,
          "STR%": 2.9,
          "DEX%": 2.9,
          "INT%": 2.9,
          "LUK%": 2.9,
          "全属性%": 2.9
        }
      }
    }
    const legendaryData = {
      "恢复方块": {
        "帽子": {
          "減少所有技能冷卻時間1秒": 6.98,
          "減少所有技能冷卻時間2秒": 4.65,
          "垃圾": 34.88,
          "STR%": 9.3,
          "DEX%": 9.3,
          "INT%": 9.3,
          "LUK%": 9.3,
          "最大HP%": 9.3,
          "全属性%": 6.98
        },
        "上衣": {
          "垃圾": 43.92,
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "全属性%": 7.32
        },
        "套服": {
          "垃圾": 43.92,
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "全属性%": 7.32
        },
        "下衣": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "手套": {
          "爆击伤害%": 9.52,
          "垃圾": 35.7,
          "STR%": 9.52,
          "DEX%": 9.52,
          "INT%": 9.52,
          "LUK%": 9.52,
          "最大HP%": 9.52,
          "全属性%": 7.14
        },
        "鞋子": {
          "垃圾": 39.48,
          "STR%": 10.53,
          "DEX%": 10.53,
          "INT%": 10.53,
          "LUK%": 10.53,
          "最大HP%": 10.53,
          "全属性%": 7.89
        },
        "披风": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "腰带": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "肩膀": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "心脏": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "胸章": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "坠饰": {
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "垃圾": 29.28,
          "全属性%": 7.32,
          "枫币获得量%": 7.32,
          "道具掉落率%": 7.32
        },
        "戒指": {
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "垃圾": 29.28,
          "全属性%": 7.32,
          "枫币获得量%": 7.32,
          "道具掉落率%": 7.32
        },
        "脸部装饰": {
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "垃圾": 29.28,
          "全属性%": 7.32,
          "枫币获得量%": 7.32,
          "道具掉落率%": 7.32
        },
        "眼部装饰": {
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "垃圾": 29.28,
          "全属性%": 7.32,
          "枫币获得量%": 7.32,
          "道具掉落率%": 7.32
        },
        "耳环": {
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "垃圾": 29.28,
          "全属性%": 7.32,
          "枫币获得量%": 7.32,
          "道具掉落率%": 7.32
        },
        "武器": {
          "物理攻击力%": 4.44,
          "魔法攻击力%": 4.44,
          "总伤害%": 4.44,
          "無視怪物防御力+35%": 6.67,
          "無視怪物防御力+40%": 6.67,
          "攻击BOSS怪物時伤害增加+35%": 8.89,
          "攻击BOSS怪物時伤害增加+40%": 4.44,
          "爆击几率%": 4.44,
          "物理攻击力": 6.67,
          "魔法攻击力": 6.67,
          "STR%": 8.89,
          "DEX%": 8.89,
          "INT%": 8.89,
          "LUK%": 8.89,
          "全属性%": 6.67
        },
        "辅助武器": {
          "物理攻击力%": 4.44,
          "魔法攻击力%": 4.44,
          "总伤害%": 4.44,
          "無視怪物防御力+35%": 6.67,
          "無視怪物防御力+40%": 6.67,
          "攻击BOSS怪物時伤害增加+35%": 8.89,
          "攻击BOSS怪物時伤害增加+40%": 4.44,
          "爆击几率%": 4.44,
          "物理攻击力": 6.67,
          "魔法攻击力": 6.67,
          "STR%": 8.89,
          "DEX%": 8.89,
          "INT%": 8.89,
          "LUK%": 8.89,
          "全属性%": 6.67
        },
        "徽章": {
          "物理攻击力%": 5.13,
          "魔法攻击力%": 5.13,
          "总伤害%": 5.13,
          "無視怪物防御力+35%": 7.69,
          "無視怪物防御力+40%": 7.69,
          "爆击几率%": 5.13,
          "物理攻击力": 7.69,
          "魔法攻击力": 7.69,
          "STR%": 10.26,
          "DEX%": 10.26,
          "INT%": 10.26,
          "LUK%": 10.26,
          "全属性%": 7.69
        }
      },
      "闪耀镜射方块": {
        "帽子": {
          "減少所有技能冷卻時間1秒": 9.38,
          "減少所有技能冷卻時間2秒": 6.25,
          "垃圾": 46.88,
          "STR%": 6.25,
          "DEX%": 6.25,
          "INT%": 6.25,
          "LUK%": 6.25,
          "最大HP%": 6.25,
          "全属性%": 6.25
        },
        "上衣": {
          "垃圾": 59.989999999999995,
          "STR%": 6.67,
          "DEX%": 6.67,
          "INT%": 6.67,
          "LUK%": 6.67,
          "最大HP%": 6.67,
          "全属性%": 6.67
        },
        "套服": {
          "垃圾": 59.989999999999995,
          "STR%": 6.67,
          "DEX%": 6.67,
          "INT%": 6.67,
          "LUK%": 6.67,
          "最大HP%": 6.67,
          "全属性%": 6.67
        },
        "下衣": {
          "STR%": 8.33,
          "DEX%": 8.33,
          "INT%": 8.33,
          "LUK%": 8.33,
          "最大HP%": 8.33,
          "垃圾": 50.010000000000005,
          "全属性%": 8.33
        },
        "手套": {
          "爆击伤害%": 12.9,
          "垃圾": 48.379999999999995,
          "STR%": 6.45,
          "DEX%": 6.45,
          "INT%": 6.45,
          "LUK%": 6.45,
          "最大HP%": 6.45,
          "全属性%": 6.45
        },
        "鞋子": {
          "垃圾": 55.540000000000006,
          "STR%": 7.41,
          "DEX%": 7.41,
          "INT%": 7.41,
          "LUK%": 7.41,
          "最大HP%": 7.41,
          "全属性%": 7.41
        },
        "披风": {
          "STR%": 8.33,
          "DEX%": 8.33,
          "INT%": 8.33,
          "LUK%": 8.33,
          "最大HP%": 8.33,
          "垃圾": 50.010000000000005,
          "全属性%": 8.33
        },
        "腰带": {
          "STR%": 8.33,
          "DEX%": 8.33,
          "INT%": 8.33,
          "LUK%": 8.33,
          "最大HP%": 8.33,
          "垃圾": 50.010000000000005,
          "全属性%": 8.33
        },
        "肩膀": {
          "STR%": 8.33,
          "DEX%": 8.33,
          "INT%": 8.33,
          "LUK%": 8.33,
          "最大HP%": 8.33,
          "垃圾": 50.010000000000005,
          "全属性%": 8.33
        },
        "心脏": {
          "STR%": 8.33,
          "DEX%": 8.33,
          "INT%": 8.33,
          "LUK%": 8.33,
          "最大HP%": 8.33,
          "垃圾": 50.010000000000005,
          "全属性%": 8.33
        },
        "胸章": {
          "STR%": 8.33,
          "DEX%": 8.33,
          "INT%": 8.33,
          "LUK%": 8.33,
          "最大HP%": 8.33,
          "垃圾": 50.010000000000005,
          "全属性%": 8.33
        },
        "坠饰": {
          "STR%": 6.67,
          "DEX%": 6.67,
          "INT%": 6.67,
          "LUK%": 6.67,
          "最大HP%": 6.67,
          "垃圾": 39.99,
          "全属性%": 6.67,
          "枫币获得量%": 10.0,
          "道具掉落率%": 10.0
        },
        "戒指": {
          "STR%": 6.67,
          "DEX%": 6.67,
          "INT%": 6.67,
          "LUK%": 6.67,
          "最大HP%": 6.67,
          "垃圾": 39.99,
          "全属性%": 6.67,
          "枫币获得量%": 10.0,
          "道具掉落率%": 10.0
        },
        "脸部装饰": {
          "STR%": 6.67,
          "DEX%": 6.67,
          "INT%": 6.67,
          "LUK%": 6.67,
          "最大HP%": 6.67,
          "垃圾": 39.99,
          "全属性%": 6.67,
          "枫币获得量%": 10.0,
          "道具掉落率%": 10.0
        },
        "眼部装饰": {
          "STR%": 6.67,
          "DEX%": 6.67,
          "INT%": 6.67,
          "LUK%": 6.67,
          "最大HP%": 6.67,
          "垃圾": 39.99,
          "全属性%": 6.67,
          "枫币获得量%": 10.0,
          "道具掉落率%": 10.0
        },
        "耳环": {
          "STR%": 6.67,
          "DEX%": 6.67,
          "INT%": 6.67,
          "LUK%": 6.67,
          "最大HP%": 6.67,
          "垃圾": 39.99,
          "全属性%": 6.67,
          "枫币获得量%": 10.0,
          "道具掉落率%": 10.0
        },
        "武器": {
          "物理攻击力%": 2.78,
          "魔法攻击力%": 2.78,
          "总伤害%": 2.78,
          "無視怪物防御力+35%": 5.56,
          "無視怪物防御力+40%": 5.56,
          "攻击BOSS怪物時伤害增加+35%": 5.56,
          "攻击BOSS怪物時伤害增加+40%": 2.78,
          "爆击几率%": 2.78,
          "物理攻击力": 8.33,
          "魔法攻击力": 8.33,
          "STR%": 11.11,
          "DEX%": 11.11,
          "INT%": 11.11,
          "LUK%": 11.11,
          "全属性%": 8.33
        },
        "辅助武器": {
          "物理攻击力%": 2.78,
          "魔法攻击力%": 2.78,
          "总伤害%": 2.78,
          "無視怪物防御力+35%": 5.56,
          "無視怪物防御力+40%": 5.56,
          "攻击BOSS怪物時伤害增加+35%": 5.56,
          "攻击BOSS怪物時伤害增加+40%": 2.78,
          "爆击几率%": 2.78,
          "物理攻击力": 8.33,
          "魔法攻击力": 8.33,
          "STR%": 11.11,
          "DEX%": 11.11,
          "INT%": 11.11,
          "LUK%": 11.11,
          "全属性%": 8.33
        },
        "徽章": {
          "物理攻击力%": 3.03,
          "魔法攻击力%": 3.03,
          "总伤害%": 3.03,
          "無視怪物防御力+35%": 6.06,
          "無視怪物防御力+40%": 6.06,
          "爆击几率%": 3.03,
          "物理攻击力": 9.09,
          "魔法攻击力": 9.09,
          "STR%": 12.12,
          "DEX%": 12.12,
          "INT%": 12.12,
          "LUK%": 12.12,
          "全属性%": 9.09
        }
      },
      "闪炫方块": {
        "帽子": {
          "減少所有技能冷卻時間1秒": 6.98,
          "減少所有技能冷卻時間2秒": 4.65,
          "垃圾": 34.88,
          "STR%": 9.3,
          "DEX%": 9.3,
          "INT%": 9.3,
          "LUK%": 9.3,
          "最大HP%": 9.3,
          "全属性%": 6.98
        },
        "上衣": {
          "垃圾": 43.92,
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "全属性%": 7.32
        },
        "套服": {
          "垃圾": 43.92,
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "全属性%": 7.32
        },
        "下衣": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "手套": {
          "爆击伤害%": 9.52,
          "垃圾": 35.7,
          "STR%": 9.52,
          "DEX%": 9.52,
          "INT%": 9.52,
          "LUK%": 9.52,
          "最大HP%": 9.52,
          "全属性%": 7.14
        },
        "鞋子": {
          "垃圾": 39.48,
          "STR%": 10.53,
          "DEX%": 10.53,
          "INT%": 10.53,
          "LUK%": 10.53,
          "最大HP%": 10.53,
          "全属性%": 7.89
        },
        "披风": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "腰带": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "肩膀": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "心脏": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "胸章": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "坠饰": {
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "垃圾": 29.28,
          "全属性%": 7.32,
          "枫币获得量%": 7.32,
          "道具掉落率%": 7.32
        },
        "戒指": {
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "垃圾": 29.28,
          "全属性%": 7.32,
          "枫币获得量%": 7.32,
          "道具掉落率%": 7.32
        },
        "脸部装饰": {
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "垃圾": 29.28,
          "全属性%": 7.32,
          "枫币获得量%": 7.32,
          "道具掉落率%": 7.32
        },
        "眼部装饰": {
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "垃圾": 29.28,
          "全属性%": 7.32,
          "枫币获得量%": 7.32,
          "道具掉落率%": 7.32
        },
        "耳环": {
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "垃圾": 29.28,
          "全属性%": 7.32,
          "枫币获得量%": 7.32,
          "道具掉落率%": 7.32
        },
        "武器": {
          "物理攻击力%": 4.44,
          "魔法攻击力%": 4.44,
          "总伤害%": 4.44,
          "無視怪物防御力+35%": 6.67,
          "無視怪物防御力+40%": 6.67,
          "攻击BOSS怪物時伤害增加+35%": 8.89,
          "攻击BOSS怪物時伤害增加+40%": 4.44,
          "爆击几率%": 4.44,
          "物理攻击力": 6.67,
          "魔法攻击力": 6.67,
          "STR%": 8.89,
          "DEX%": 8.89,
          "INT%": 8.89,
          "LUK%": 8.89,
          "全属性%": 6.67
        },
        "辅助武器": {
          "物理攻击力%": 4.44,
          "魔法攻击力%": 4.44,
          "总伤害%": 4.44,
          "無視怪物防御力+35%": 6.67,
          "無視怪物防御力+40%": 6.67,
          "攻击BOSS怪物時伤害增加+35%": 8.89,
          "攻击BOSS怪物時伤害增加+40%": 4.44,
          "爆击几率%": 4.44,
          "物理攻击力": 6.67,
          "魔法攻击力": 6.67,
          "STR%": 8.89,
          "DEX%": 8.89,
          "INT%": 8.89,
          "LUK%": 8.89,
          "全属性%": 6.67
        },
        "徽章": {
          "物理攻击力%": 5.13,
          "魔法攻击力%": 5.13,
          "总伤害%": 5.13,
          "無視怪物防御力+35%": 7.69,
          "無視怪物防御力+40%": 7.69,
          "爆击几率%": 5.13,
          "物理攻击力": 7.69,
          "魔法攻击力": 7.69,
          "STR%": 10.26,
          "DEX%": 10.26,
          "INT%": 10.26,
          "LUK%": 10.26,
          "全属性%": 7.69
        }
      },
      "新对等方块": {
        "帽子": {
          "減少所有技能冷卻時間1秒": 6.98,
          "減少所有技能冷卻時間2秒": 4.65,
          "垃圾": 34.88,
          "STR%": 9.3,
          "DEX%": 9.3,
          "INT%": 9.3,
          "LUK%": 9.3,
          "最大HP%": 9.3,
          "全属性%": 6.98
        },
        "上衣": {
          "垃圾": 43.92,
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "全属性%": 7.32
        },
        "套服": {
          "垃圾": 43.92,
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "全属性%": 7.32
        },
        "下衣": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "手套": {
          "爆击伤害%": 9.52,
          "垃圾": 35.7,
          "STR%": 9.52,
          "DEX%": 9.52,
          "INT%": 9.52,
          "LUK%": 9.52,
          "最大HP%": 9.52,
          "全属性%": 7.14
        },
        "鞋子": {
          "垃圾": 39.48,
          "STR%": 10.53,
          "DEX%": 10.53,
          "INT%": 10.53,
          "LUK%": 10.53,
          "最大HP%": 10.53,
          "全属性%": 7.89
        },
        "披风": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "腰带": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "肩膀": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "心脏": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "胸章": {
          "STR%": 11.43,
          "DEX%": 11.43,
          "INT%": 11.43,
          "LUK%": 11.43,
          "最大HP%": 11.43,
          "垃圾": 34.29,
          "全属性%": 8.57
        },
        "坠饰": {
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "垃圾": 29.28,
          "全属性%": 7.32,
          "枫币获得量%": 7.32,
          "道具掉落率%": 7.32
        },
        "戒指": {
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "垃圾": 29.28,
          "全属性%": 7.32,
          "枫币获得量%": 7.32,
          "道具掉落率%": 7.32
        },
        "脸部装饰": {
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "垃圾": 29.28,
          "全属性%": 7.32,
          "枫币获得量%": 7.32,
          "道具掉落率%": 7.32
        },
        "眼部装饰": {
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "垃圾": 29.28,
          "全属性%": 7.32,
          "枫币获得量%": 7.32,
          "道具掉落率%": 7.32
        },
        "耳环": {
          "STR%": 9.76,
          "DEX%": 9.76,
          "INT%": 9.76,
          "LUK%": 9.76,
          "最大HP%": 9.76,
          "垃圾": 29.28,
          "全属性%": 7.32,
          "枫币获得量%": 7.32,
          "道具掉落率%": 7.32
        },
        "武器": {
          "物理攻击力%": 4.44,
          "魔法攻击力%": 4.44,
          "总伤害%": 4.44,
          "無視怪物防御力+35%": 6.67,
          "無視怪物防御力+40%": 6.67,
          "攻击BOSS怪物時伤害增加+35%": 8.89,
          "攻击BOSS怪物時伤害增加+40%": 4.44,
          "爆击几率%": 4.44,
          "物理攻击力": 6.67,
          "魔法攻击力": 6.67,
          "STR%": 8.89,
          "DEX%": 8.89,
          "INT%": 8.89,
          "LUK%": 8.89,
          "全属性%": 6.67
        },
        "辅助武器": {
          "物理攻击力%": 4.44,
          "魔法攻击力%": 4.44,
          "总伤害%": 4.44,
          "無視怪物防御力+35%": 6.67,
          "無視怪物防御力+40%": 6.67,
          "攻击BOSS怪物時伤害增加+35%": 8.89,
          "攻击BOSS怪物時伤害增加+40%": 4.44,
          "爆击几率%": 4.44,
          "物理攻击力": 6.67,
          "魔法攻击力": 6.67,
          "STR%": 8.89,
          "DEX%": 8.89,
          "INT%": 8.89,
          "LUK%": 8.89,
          "全属性%": 6.67
        },
        "徽章": {
          "物理攻击力%": 5.13,
          "魔法攻击力%": 5.13,
          "总伤害%": 5.13,
          "無視怪物防御力+35%": 7.69,
          "無視怪物防御力+40%": 7.69,
          "爆击几率%": 5.13,
          "物理攻击力": 7.69,
          "魔法攻击力": 7.69,
          "STR%": 10.26,
          "DEX%": 10.26,
          "INT%": 10.26,
          "LUK%": 10.26,
          "全属性%": 7.69
        }
      },
      "结合方块": {
        "帽子": {
          "減少所有技能冷卻時間1秒": 11.11,
          "減少所有技能冷卻時間2秒": 11.11,
          "垃圾": 48.61,
          "STR%": 5.56,
          "DEX%": 5.56,
          "INT%": 5.56,
          "LUK%": 5.56,
          "最大HP%": 5.56,
          "全属性%": 1.39
        },
        "上衣": {
          "垃圾": 63.79,
          "STR%": 6.9,
          "DEX%": 6.9,
          "INT%": 6.9,
          "LUK%": 6.9,
          "最大HP%": 6.9,
          "全属性%": 1.72
        },
        "套服": {
          "垃圾": 63.79,
          "STR%": 6.9,
          "DEX%": 6.9,
          "INT%": 6.9,
          "LUK%": 6.9,
          "最大HP%": 6.9,
          "全属性%": 1.72
        },
        "下衣": {
          "STR%": 10.26,
          "DEX%": 10.26,
          "INT%": 10.26,
          "LUK%": 10.26,
          "最大HP%": 10.26,
          "垃圾": 46.14,
          "全属性%": 2.56
        },
        "手套": {
          "爆击伤害%": 3.39,
          "垃圾": 61.01,
          "STR%": 6.78,
          "DEX%": 6.78,
          "INT%": 6.78,
          "LUK%": 6.78,
          "最大HP%": 6.78,
          "全属性%": 1.69
        },
        "鞋子": {
          "垃圾": 56.239999999999995,
          "STR%": 8.33,
          "DEX%": 8.33,
          "INT%": 8.33,
          "LUK%": 8.33,
          "最大HP%": 8.33,
          "全属性%": 2.08
        },
        "披风": {
          "STR%": 10.26,
          "DEX%": 10.26,
          "INT%": 10.26,
          "LUK%": 10.26,
          "最大HP%": 10.26,
          "垃圾": 41.02,
          "全属性%": 7.69
        },
        "腰带": {
          "STR%": 10.26,
          "DEX%": 10.26,
          "INT%": 10.26,
          "LUK%": 10.26,
          "最大HP%": 10.26,
          "垃圾": 41.02,
          "全属性%": 7.69
        },
        "肩膀": {
          "STR%": 10.26,
          "DEX%": 10.26,
          "INT%": 10.26,
          "LUK%": 10.26,
          "最大HP%": 10.26,
          "垃圾": 41.02,
          "全属性%": 7.69
        },
        "心脏": {
          "STR%": 10.26,
          "DEX%": 10.26,
          "INT%": 10.26,
          "LUK%": 10.26,
          "最大HP%": 10.26,
          "垃圾": 41.02,
          "全属性%": 7.69
        },
        "胸章": {
          "STR%": 10.26,
          "DEX%": 10.26,
          "INT%": 10.26,
          "LUK%": 10.26,
          "最大HP%": 10.26,
          "垃圾": 41.02,
          "全属性%": 7.69
        },
        "坠饰": {
          "STR%": 7.02,
          "DEX%": 7.02,
          "INT%": 7.02,
          "LUK%": 7.02,
          "最大HP%": 7.02,
          "垃圾": 42.12,
          "全属性%": 1.75,
          "枫币获得量%": 10.53,
          "道具掉落率%": 10.53
        },
        "戒指": {
          "STR%": 7.02,
          "DEX%": 7.02,
          "INT%": 7.02,
          "LUK%": 7.02,
          "最大HP%": 7.02,
          "垃圾": 42.12,
          "全属性%": 1.75,
          "枫币获得量%": 10.53,
          "道具掉落率%": 10.53
        },
        "脸部装饰": {
          "STR%": 7.02,
          "DEX%": 7.02,
          "INT%": 7.02,
          "LUK%": 7.02,
          "最大HP%": 7.02,
          "垃圾": 42.12,
          "全属性%": 1.75,
          "枫币获得量%": 10.53,
          "道具掉落率%": 10.53
        },
        "眼部装饰": {
          "STR%": 7.02,
          "DEX%": 7.02,
          "INT%": 7.02,
          "LUK%": 7.02,
          "最大HP%": 7.02,
          "垃圾": 42.12,
          "全属性%": 1.75,
          "枫币获得量%": 10.53,
          "道具掉落率%": 10.53
        },
        "耳环": {
          "STR%": 7.02,
          "DEX%": 7.02,
          "INT%": 7.02,
          "LUK%": 7.02,
          "最大HP%": 7.02,
          "垃圾": 42.12,
          "全属性%": 1.75,
          "枫币获得量%": 10.53,
          "道具掉落率%": 10.53
        },
        "武器": {
          "物理攻击力%": 3.24,
          "魔法攻击力%": 3.24,
          "总伤害%": 16.18,
          "無視怪物防御力+35%": 25.89,
          "無視怪物防御力+40%": 16.18,
          "攻击BOSS怪物時伤害增加+35%": 5.18,
          "攻击BOSS怪物時伤害增加+40%": 1.13,
          "爆击几率%": 21.04,
          "物理攻击力": 1.13,
          "魔法攻击力": 1.13,
          "STR%": 1.13,
          "DEX%": 1.13,
          "INT%": 1.13,
          "LUK%": 1.13,
          "全属性%": 1.13
        },
        "辅助武器": {
          "物理攻击力%": 3.24,
          "魔法攻击力%": 3.24,
          "总伤害%": 16.18,
          "無視怪物防御力+35%": 25.89,
          "無視怪物防御力+40%": 16.18,
          "攻击BOSS怪物時伤害增加+35%": 5.18,
          "攻击BOSS怪物時伤害增加+40%": 1.13,
          "爆击几率%": 21.04,
          "物理攻击力": 1.13,
          "魔法攻击力": 1.13,
          "STR%": 1.13,
          "DEX%": 1.13,
          "INT%": 1.13,
          "LUK%": 1.13,
          "全属性%": 1.13
        },
        "徽章": {
          "物理攻击力%": 3.45,
          "魔法攻击力%": 3.45,
          "总伤害%": 17.27,
          "無視怪物防御力+35%": 27.63,
          "無視怪物防御力+40%": 17.27,
          "爆击几率%": 22.45,
          "物理攻击力": 1.21,
          "魔法攻击力": 1.21,
          "STR%": 1.21,
          "DEX%": 1.21,
          "INT%": 1.21,
          "LUK%": 1.21,
          "全属性%": 1.21
        }
      }
    }
    // --- 概率配置（根据你给出的表） ---
    const cubeData = {
      "恢复方块": {
        lowLevel: {
          "1": 0,
          "2": 80,
          "3": 95
        },
        upgrade: {
          "Rare": { "Epic": 97.7, "Unique": 2, "Legendary": 0.3 },
          "Epic": { "Epic": 91.4, "Unique": 8.0, "Legendary": 0.6 },
          "Unique": { "Unique": 97.9, "Legendary": 2.1 },
          "Legendary": { "Legendary": 100.0 }
        }
      },
      "闪耀镜射方块": {
        lowLevel: {
          "1": 0,
          "2": 80,
          "3": 95
        },
        upgrade: {
          "Rare": { "Rare": 3, "Epic": 97 },
          "Epic": { "Epic": 97.75, "Unique": 2.25 },
          "Unique": { "Unique": 99.01, "Legendary": 0.99 },
          "Legendary": { "Legendary": 100.0 }
        }
      },
      "闪炫方块": {
        lowLevel: {
          "1": 0,
          "2": 80,
          "3": 85,
          "4": 0,
          "5": 80,
          "6": 85
        },
        upgrade: {
          "Rare": { "Rare": 3, "Epic": 97 },
          "Epic": { "Epic": 97, "Unique": 3 },
          "Unique": { "Unique": 98.65, "Legendary": 1.35 },
          "Legendary": { "Legendary": 100.0 }
        }
      },
      "新对等方块": {
        lowLevel: {
          "1": 0,
          "2": 0,
          "3": 0
        },
        upgrade: {
          "Rare": { "Rare": 3, "Epic": 97 },
          "Epic": { "Epic": 97, "Unique": 3 },
          "Unique": { "Unique": 98.65, "Legendary": 1.35 },
          "Legendary": { "Legendary": 100.0 }
        }
      },
      "结合方块": {
        lowLevel: {
          "1": 85,
          "2": 85,
          "3": 85
        },
        upgrade: {
          "Rare": { "Rare": 100.0 },
          "Epic": { "Epic": 100.0 },
          "Unique": { "Unique": 100.0 },
          "Legendary": { "Legendary": 100.0 }
        }
      }
    };

    // --- 辅助函数：确保返回包含所有等级键（缺的设为0） ---
    function normalizeToAllTiers(dist) {
      const out = {};
      for (const t of TIERS) out[t] = 0;
      for (const k in dist) {
        if (out.hasOwnProperty(k)) out[k] = Number(dist[k]) || 0;
      }
      return out;
    }

    // 计算给定装备类型与等级下的可选潜能（用于“当前潜能”三个下拉框）
    function buildLabeledNameGlobal(tier, name, equipLevel) {
      const isAllStat = name === '全属性%';
      const isMainStat = /^(STR%|DEX%|INT%|LUK%|最大HP%|物理攻击力%|魔法攻击力%|总伤害%)$/.test(name);
      const isHigh = Number(equipLevel) > 155;
      if (!isAllStat && !isMainStat) return name;
      let val;
      if (tier === 'Legendary') val = isAllStat ? (isHigh ? 10 : 9) : (isHigh ? 13 : 12);
      else val = isAllStat ? (isHigh ? 7 : 6) : (isHigh ? 10 : 9);
      const base = name.replace('%', '');
      return `${base}+${val}%`;
    }

    function pickPoolByType(source, cubeTypeKey, equipType) {
      if (!source || !source[cubeTypeKey]) return null;
      const dict = source[cubeTypeKey];
      if (dict[equipType]) return dict[equipType];
      return null;
    }

    function computeAvailableLines(equipType, equipLevel, currentTier) {
      const poolLegend = pickPoolByType(legendaryData, '恢复方块', equipType) || {};
      const poolUnique = pickPoolByType(uniqueData, '恢复方块', equipType) || {};

      const options = [];
      // 垃圾固定项
      options.push({ value: 'TRASH', label: '垃圾' });

      function pushFromPool(tier, pool) {
        for (const k in pool) {
          if (k === '物理攻击力' || k === '魔法攻击力') continue; // 排除非百分比的固定数值行
          if (k === '垃圾') continue;
          // 合并“爆击几率%”为一个跨阶项
          const isCrit = k === '爆击几率%';
          const label = isCrit ? '爆击几率%' : buildLabeledNameGlobal(tier, k, equipLevel);
          const value = isCrit ? 'CRIT' : `${tier}::${k}`;
          options.push({ value, label });
        }
      }

      if (currentTier === 'Legendary') {
        // 传说可同时出现传说与罕见行
        pushFromPool('Legendary', poolLegend);
        pushFromPool('Unique', poolUnique);
      } else {
        // 非传说仅提供罕见词条
        pushFromPool('Unique', poolUnique);
      }

      // 去重并按标签排序（字典序）
      const seen = new Set();
      const dedup = [];
      for (const opt of options) {
        const key = opt.value;
        if (seen.has(key)) continue;
        seen.add(key);
        dedup.push(opt);
      }
      dedup.sort((a, b) => a.label.localeCompare(b.label, 'zh-Hans-CN'));
      // 确保“垃圾”在最前
      dedup.sort((a, b) => (a.value === 'TRASH' ? -1 : (b.value === 'TRASH' ? 1 : 0)));
      return dedup;
    }

    function fillCurrentLineSelects() {
      const equipType = document.getElementById('equipType').value;
      const equipLevel = document.getElementById('equipLevel').value;
      const currentTier = document.getElementById('currentTier').value;
      const opts = computeAvailableLines(equipType, equipLevel, currentTier);
      const ids = ['currentLine1', 'currentLine2', 'currentLine3'];
      ids.forEach(function (id) {
        const sel = document.getElementById(id);
        if (!sel) return;
        sel.innerHTML = '';
        opts.forEach(function (o) {
          const opt = document.createElement('option');
          opt.value = o.value;
          opt.textContent = o.label;
          sel.appendChild(opt);
        });
        sel.value = 'TRASH';
      });
    }

    function updateCurrentLinesUI() {
      const group = document.getElementById('currentLinesGroup');
      if (!group) return;
      const tier = document.getElementById('currentTier').value;
      const show = tier === 'Legendary';
      group.style.display = show ? '' : 'none';
      if (show) fillCurrentLineSelects();
    }

    // 计算「使用一次魔方后」的最终分布（最低从 Rare 开始）
    function getResultDistribution(cubeType, current) {
      const data = cubeData[cubeType];
      if (!data) return normalizeToAllTiers({});
      const up = (data.upgrade && data.upgrade[current]) ? data.upgrade[current] : { [current]: 100.0 };
      return normalizeToAllTiers(up);
    }

    // 生成 HTML 表格并显示
    function renderProbabilityTable(cubeType, equipType, equipLevel, current) {
      const dist = getResultDistribution(cubeType, current);
      // 计算晋阶概率（比当前更高的等级）
      let promotionProb = 0;
      const currentIdx = TIERS.indexOf(current);
      for (let i = currentIdx + 1; i < TIERS.length; i++) {
        promotionProb += (dist[TIERS[i]] || 0);
      }

      // summary
      const summaryEl = document.getElementById('probSummary');
      let summaryHtml = `<strong>选择：</strong> 魔方：${cubeType}； 装备：${equipType}（Lv.${equipLevel}）； 当前潜能：${TIER_LABEL[current]}<br>`;
      summaryHtml += `<strong>晋阶概率（升到更高阶）：</strong> ${promotionProb.toFixed(2)}%`;
      summaryEl.innerHTML = summaryHtml;

      // table
      const container = document.getElementById('probTableContainer');
      let html = `<table class="table table-sm table-bordered" style="max-width:520px;"><thead><tr><th>潜能等级</th><th>概率</th></tr></thead><tbody>`;
      for (const t of TIERS) {
        html += `<tr><td>${TIER_LABEL[t]}</td><td style="min-width:140px">${(dist[t] || 0).toFixed(2)}%</td></tr>`;
      }
      html += `</tbody></table>`;

      container.innerHTML = html;
    }

    // 渲染“结果概率表”：根据不同的魔方类型调用对应处理函数
    function renderResultTierTable(cubeType, equipType, equipLevel, current) {
      const container = document.getElementById('resultTierTableContainer');
      if (!container) return;

      switch (cubeType) {
        case '恢复方块':
          return renderResultTableForRecovery(container, equipType, equipLevel, current);
        case '闪耀镜射方块':
          return renderResultTableForShiningMirror(container, equipType, equipLevel, current);
        case '闪炫方块':
          return renderResultTableForFlashing(container, equipType, equipLevel, current);
        case '新对等方块':
          return renderResultTableForNeoEqual(container, equipType, equipLevel, current);
        case '结合方块':
          return renderResultTableForFusion(container, equipType, equipLevel, current);
        default:
          return renderResultTableForRecovery(container, equipType, equipLevel, current);
      }
    }

    // 各魔方类型的结果概率表渲染函数
    function renderResultTableForRecovery(container, equipType, equipLevel, current) {
      // 非传说：仅显示是否升级
      if (current !== 'Legendary') {
        const dist = getResultDistribution('恢复方块', current);
        const idx = TIERS.indexOf(current);
        let upgradeProb = 0;
        for (let i = idx + 1; i < TIERS.length; i++) upgradeProb += (dist[TIERS[i]] || 0);
        const stayProb = Math.max(0, 100 - upgradeProb);
        container.innerHTML = `
          <div class="small text-muted mb-2">恢复方块（当前非传说）仅判定是否升级：</div>
          <table class="table table-sm table-bordered mb-0" style="max-width:520px;">
            <thead><tr><th>结果</th><th style="width:140px">概率</th></tr></thead>
            <tbody>
              <tr><td>升级</td><td>${upgradeProb.toFixed(2)}%</td></tr>
              <tr><td>未升级</td><td>${stayProb.toFixed(2)}%</td></tr>
            </tbody>
          </table>`;
        return;
      }

      // 传说：三条潜能，每条先判定 Legendary/Unique，再按各自词条池抽取
      const data = cubeData['恢复方块'];
      const lowLevel = (data && data.lowLevel) ? data.lowLevel : {};
      const pUniqueLine = [0, Number(lowLevel['1']) || 0, Number(lowLevel['2']) || 0, Number(lowLevel['3']) || 0];
      const pLegendLine = [0, 100 - pUniqueLine[1], 100 - pUniqueLine[2], 100 - pUniqueLine[3]];

      // 装备类型别名处理
      const aliasList = (function () {
        const arr = [equipType];
        return Array.from(new Set(arr));
      })();

      function pickPool(source) {
        if (!source || !source['恢复方块']) return null;
        const dict = source['恢复方块'];
        for (const k of aliasList) if (dict[k]) return dict[k];
        return null;
      }

      const poolLegend = pickPool(legendaryData) || {};
      const poolUnique = pickPool(uniqueData) || {};

      // 过滤未知数值的“物理攻击力”“魔法攻击力”（不带百分号）
      function normalizeEntries(pool) {
        const out = [];
        for (const k in pool) {
          //if (k === '物理攻击力' || k === '魔法攻击力') continue;
          const v = Number(pool[k]) || 0;
          out.push({ name: k, p: v });
        }
        out.sort((a, b) => b.p - a.p);
        return out;
      }

      const entriesLegend = normalizeEntries(poolLegend);
      const entriesUnique = normalizeEntries(poolUnique);

      // 数值标注与合并表
      const isHigh = Number(equipLevel) > 155;
      function buildLabeledName(tier, name) {
        const isAllStat = name === '全属性%';
        const isMainStat = /^(STR%|DEX%|INT%|LUK%|最大HP%|物理攻击力%|魔法攻击力%|总伤害%)$/.test(name);
        if (!isAllStat && !isMainStat) return name;
        let val;
        if (tier === 'Legendary') val = isAllStat ? (isHigh ? 10 : 9) : (isHigh ? 13 : 12);
        else val = isAllStat ? (isHigh ? 7 : 6) : (isHigh ? 10 : 9);
        const base = name.replace('%', '');
        return `${base}+${val}%`;
      }

      const rowMap = new Map();
      function addRowsFromPool(tier, entries, lineProbs) {
        for (const row of entries) {
          const isTrash = row.name === '垃圾';
          const isCrit = row.name === '爆击几率%';
          const key = isTrash ? 'TRASH' : (isCrit ? 'CRIT' : (tier + '::' + row.name));
          const label = isTrash ? '垃圾' : (isCrit ? '爆击几率%' : buildLabeledName(tier, row.name));
          if (!rowMap.has(key)) rowMap.set(key, { label: label, probs: [0, 0, 0] });
          const rec = rowMap.get(key);
          rec.probs[0] += (row.p * lineProbs[1]) / 100;
          rec.probs[1] += (row.p * lineProbs[2]) / 100;
          rec.probs[2] += (row.p * lineProbs[3]) / 100;
        }
      }

      addRowsFromPool('Legendary', entriesLegend, pLegendLine);
      addRowsFromPool('Unique', entriesUnique, pUniqueLine);

      const allRows = Array.from(rowMap.values());

      const state = { key: 'sum', asc: false };
      const fmtProb = (v) => (v === 0 ? '/' : `${v.toFixed(2)}%`);

      function getSortedRows() {
        const rows = allRows.slice();
        rows.sort(function (a, b) {
          if (state.key === 'label') {
            return state.asc ? a.label.localeCompare(b.label) : b.label.localeCompare(a.label);
          }
          var vA = 0, vB = 0;
          if (state.key === 'c1') { vA = a.probs[0]; vB = b.probs[0]; }
          else if (state.key === 'c2') { vA = a.probs[1]; vB = b.probs[1]; }
          else if (state.key === 'c3') { vA = a.probs[2]; vB = b.probs[2]; }
          else { vA = a.probs[0] + a.probs[1] + a.probs[2]; vB = b.probs[0] + b.probs[1] + b.probs[2]; }
          return state.asc ? (vA - vB) : (vB - vA);
        });
        return rows;
      }

      function headerHtml(text, key, width) {
        const arrow = state.key === key ? (state.asc ? ' ▲' : ' ▼') : '';
        const w = width ? ` style=\"width:${width}\"` : '';
        return `<th role="button" data-key="${key}"${w}>${text}${arrow}</th>`;
      }

      function draw() {
        let html = `<div class="small text-muted">恢复方块：每次出现三条潜能；下表为一次使用下三条分别出现指定词条的概率。</div>`;
        html += `<div class="table-responsive"><table class="table table-sm table-striped table-hover align-middle mb-0">` +
          `<thead class="table-light"><tr>` +
          headerHtml('词条', 'label', '') +
          headerHtml('第一条', 'c1', '140px') +
          headerHtml('第二条', 'c2', '140px') +
          headerHtml('第三条', 'c3', '140px') +
          `</tr></thead><tbody>`;
        getSortedRows().forEach(function (r) {
          html += `<tr><td>${r.label}</td><td>${fmtProb(r.probs[0])}</td><td>${fmtProb(r.probs[1])}</td><td>${fmtProb(r.probs[2])}</td></tr>`;
        });
        html += `</tbody></table></div>`;
        container.innerHTML = html;

        // 绑定列头点击排序
        var ths = container.querySelectorAll('th[data-key]');
        ths.forEach(function (th) {
          th.style.cursor = 'pointer';
          th.addEventListener('click', function () {
            var key = th.getAttribute('data-key');
            if (state.key === key) {
              state.asc = !state.asc;
            } else {
              state.key = key;
              // 词条默认按字典序升序，其余列默认降序
              state.asc = (key === 'label');
            }
            draw();
          });
        });
      }

      draw();
    }
    function renderResultTableForShiningMirror(container, equipType, equipLevel, current) { }
    function renderResultTableForFlashing(container, equipType, equipLevel, current) { }
    function renderResultTableForNeoEqual(container, equipType, equipLevel, current) { }
    function renderResultTableForFusion(container, equipType, equipLevel, current) { }

    // --- 事件绑定（仅在点击按钮时更新） ---
    const inputs = ['equipType', 'equipLevel', 'currentTier', 'cubeType', 'showBtn'];
    function setup() {
      document.getElementById('showBtn').addEventListener('click', () => {
        const equipType = document.getElementById('equipType').value;
        const equipLevel = document.getElementById('equipLevel').value;
        const current = document.getElementById('currentTier').value;
        const cubeType = document.getElementById('cubeType').value;
        renderProbabilityTable(cubeType, equipType, equipLevel, current);
        renderResultTierTable(cubeType, equipType, equipLevel, current);
      });
      // 条件变化时刷新“当前潜能”可选项
      ['equipType', 'equipLevel', 'currentTier'].forEach(function (id) {
        const el = document.getElementById(id);
        el.addEventListener('change', updateCurrentLinesUI);
      });
      // 初始显示与填充（仅当Legendary时填充）
      updateCurrentLinesUI();
    }
    // 加载侧边栏
    fetch('sidebar.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('sidebar-container').innerHTML = data;
      })
      .catch(error => {
        console.error('加载侧边栏失败:', error);
      });

    function toggleSubMenu(id) {
      const submenu = document.getElementById(id);
      submenu.style.display = submenu.style.display === "block" ? "none" : "block";
    }
    // 绑定事件与首次渲染
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setup);
    } else {
      setup();
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>